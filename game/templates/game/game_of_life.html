{% extends 'game/base.html' %}

{% block title %}
Game of Life
{% endblock title %}

{% block content %}
<h1>Game of Life</h1>

<div class="flex flex-col justify-center items-center min-h-screen space-y-4">
    <div id="controls" class="flex justify-start items-center space-x-6">
        <button id="start-btn" class="px-6 py-2 bg-green-500 rounded">Start</button>
        <button id="stop-btn" class="px-6 py-2 bg-red-500 rounded">Stop</button>
        <button id="reset-btn" class="px-6 py-2 bg-yellow-500 rounded">Reset</button>
    </div>
    <table id="game-grid" class=""></table>
</div>

<script>
    let grid = {{ initial_grid | safe }};
    const rows = {{rows}};
    const cols = {{cols}};
    let running = false;
    let intervalId = null;

    function createGrid() {
        const table = document.getElementById("game-grid");
        table.innerHTML = "";

        for (let row = 0; row < rows; row++) {
            const tr = document.createElement("tr");
            for (let col = 0; col < cols; col++) {
                const td = document.createElement("td");
                td.className = grid[row][col] === 1 ? "alive" : "dead";
                td.addEventListener('click', () => toggleCellState(row, col));  // Make cells clickable
                tr.appendChild(td);
            }
            table.appendChild(tr);
        }
    }

    function toggleCellState(row, col) {
        grid[row][col] = grid[row][col] === 1 ? 0 : 1;
        createGrid();
    }

    function updateGrid() {
        fetch('/next_generation/', {
            method: 'POST',
            body: JSON.stringify(grid),
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
            .then(response => response.json())
            .then(data => {
                grid = data.next_grid;
                createGrid();
            });
    }

    function startGame() {
        if (!running) {
            running = true;
            intervalId = setInterval(updateGrid, 100);
        }
    }

    function stopGame() {
        if (running) {
            running = false;
            clearInterval(intervalId);
        }
    }

    function resetGame() {
        stopGame();
        grid = Array.from({length: rows}, () => Array(cols).fill(0));
        createGrid();
    }

    document.getElementById("start-btn").addEventListener("click", startGame);
    document.getElementById("stop-btn").addEventListener("click", stopGame);
    document.getElementById("reset-btn").addEventListener("click", resetGame);

    createGrid();
</script>
{% endblock content %}
